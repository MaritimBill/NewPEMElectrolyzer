<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HE-NMPC Electrolyzer Controller</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="components.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üõ°Ô∏è HE-NMPC Electrolyzer Controller</h1>
            <div class="status-bar">
                <span id="connectionStatus" class="status-offline">üî¥ OFFLINE</span>
                <span id="systemStatus">System Stopped</span>
                <span id="currentTime">--:--:--</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs" id="navTabs">
            <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
            <button class="nav-tab" data-tab="control">üéõÔ∏è Control Panel</button>
            <button class="nav-tab" data-tab="safety">üõ°Ô∏è Safety MPC</button>
            <button class="nav-tab" data-tab="economic">üí∞ Economic MPC</button>
            <button class="nav-tab" data-tab="simulink">üî¨ Simulink</button>
            <button class="nav-tab" data-tab="analytics">üìà Analytics</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid-container">
                <!-- Process Gauges -->
                <div class="card">
                    <h3>‚ö° Production Efficiency</h3>
                    <div class="gauge-container">
                        <canvas id="efficiencyGauge"></canvas>
                        <div class="gauge-value" id="efficiencyValue">75%</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üí® Oxygen Production</h3>
                    <div class="gauge-container">
                        <canvas id="productionGauge"></canvas>
                        <div class="gauge-value" id="productionValue">30%</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üõ°Ô∏è Safety Margin</h3>
                    <div class="gauge-container">
                        <canvas id="safetyGauge"></canvas>
                        <div class="gauge-value" id="safetyValue">100%</div>
                    </div>
                </div>

                <!-- Real-time Charts -->
                <div class="card chart-card">
                    <h3>üìà Production Trends</h3>
                    <canvas id="productionChart"></canvas>
                </div>

                <div class="card chart-card">
                    <h3>üå°Ô∏è System Parameters</h3>
                    <canvas id="parametersChart"></canvas>
                </div>

                <!-- System Status -->
                <div class="card status-card">
                    <h3>üîß System Status</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <label>Controller Mode:</label>
                            <span id="controllerMode">HE-NMPC</span>
                        </div>
                        <div class="status-item">
                            <label>Operation Mode:</label>
                            <span id="operationMode">AUTO</span>
                        </div>
                        <div class="status-item">
                            <label>Safety Violations:</label>
                            <span id="safetyViolations">0</span>
                        </div>
                        <div class="status-item">
                            <label>Simulink Connection:</label>
                            <span id="simulinkStatus">Disconnected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel Tab -->
        <div id="control" class="tab-content">
            <div class="grid-container">
                <div class="card">
                    <h3>üéõÔ∏è Manual Control</h3>
                    <div class="control-group">
                        <label>Production Setpoint:</label>
                        <input type="range" id="productionSlider" min="0" max="100" value="30" class="slider">
                        <div class="slider-value">
                            <span id="sliderValue">30%</span>
                            <button id="applyManual" class="btn btn-secondary">Apply</button>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>Operation Mode:</label>
                        <div class="button-group">
                            <button id="autoMode" class="btn btn-primary active">AUTO</button>
                            <button id="manualMode" class="btn btn-outline">MANUAL</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>System Control:</label>
                        <div class="button-group">
                            <button id="startSystem" class="btn btn-success">START</button>
                            <button id="stopSystem" class="btn btn-danger">STOP</button>
                            <button id="emergencyStop" class="btn btn-warning">EMERGENCY STOP</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üîß System Parameters</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <label>Water Level:</label>
                            <span id="paramWater">70%</span>
                        </div>
                        <div class="param-item">
                            <label>Chamber Temp:</label>
                            <span id="paramTemp">25¬∞C</span>
                        </div>
                        <div class="param-item">
                            <label>Oxygen Level:</label>
                            <span id="paramOxygen">40%</span>
                        </div>
                        <div class="param-item">
                            <label>Hydrogen Level:</label>
                            <span id="paramHydrogen">30%</span>
                        </div>
                        <div class="param-item">
                            <label>Purity Level:</label>
                            <span id="paramPurity">99.7%</span>
                        </div>
                        <div class="param-item">
                            <label>Battery Voltage:</label>
                            <span id="paramBattery">12.2V</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Safety MPC Tab -->
        <div id="safety" class="tab-content">
            <div class="grid-container">
                <div class="card">
                    <h3>üõ°Ô∏è Safety MPC Status</h3>
                    <div class="safety-grid">
                        <div class="safety-item critical">
                            <label>Temperature Constraint:</label>
                            <span id="tempConstraint">OK</span>
                        </div>
                        <div class="safety-item critical">
                            <label>Purity Constraint:</label>
                            <span id="purityConstraint">OK</span>
                        </div>
                        <div class="safety-item warning">
                            <label>Reserve Constraint:</label>
                            <span id="reserveConstraint">OK</span>
                        </div>
                        <div class="safety-item info">
                            <label>QP Solve Time:</label>
                            <span id="qpSolveTime">0ms</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Constraint Monitoring</h3>
                    <canvas id="constraintsChart"></canvas>
                </div>

                <div class="card">
                    <h3>‚ö° Safety Performance</h3>
                    <div class="performance-grid">
                        <div class="metric">
                            <div class="metric-value" id="safetyPerformance">100%</div>
                            <div class="metric-label">Safety Performance</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="constraintSatisfaction">100%</div>
                            <div class="metric-label">Constraint Satisfaction</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="emergencyEvents">0</div>
                            <div class="metric-label">Emergency Events</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Economic MPC Tab -->
        <div id="economic" class="tab-content">
            <div class="grid-container">
                <div class="card">
                    <h3>üí∞ Economic Optimization</h3>
                    <div class="economic-controls">
                        <div class="control-group">
                            <label>Economic Setpoint:</label>
                            <input type="range" id="economicSlider" min="0" max="100" value="30" class="slider">
                            <div class="slider-value">
                                <span id="economicValue">30%</span>
                                <button id="applyEconomic" class="btn btn-primary">Apply to Safety MPC</button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label>Optimization Parameters:</label>
                            <div class="param-inputs">
                                <input type="number" id="powerCost" placeholder="Power Cost ($/kWh)" value="0.15" step="0.01">
                                <input type="number" id="o2Price" placeholder="O2 Price ($/kg)" value="2.50" step="0.01">
                            </div>
                        </div>

                        <button id="runOptimization" class="btn btn-success">Run Economic Optimization</button>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà Economic Metrics</h3>
                    <div class="metrics-grid">
                        <div class="economic-metric">
                            <div class="metric-value" id="levelizedCost">$120.00</div>
                            <div class="metric-label">Levelized Cost of O‚ÇÇ</div>
                        </div>
                        <div class="economic-metric">
                            <div class="metric-value" id="oxygenAvailability">99.5%</div>
                            <div class="metric-label">Oxygen Availability</div>
                        </div>
                        <div class="economic-metric">
                            <div class="metric-value" id="pvUtilization">85%</div>
                            <div class="metric-label">PV Utilization</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üíπ Cost Optimization Chart</h3>
                    <canvas id="economicChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Simulink Tab -->
        <div id="simulink" class="tab-content">
            <div class="grid-container">
                <div class="card">
                    <h3>üî¨ Simulink Integration</h3>
                    <div class="simulink-controls">
                        <div class="control-group">
                            <label>Simulation Mode:</label>
                            <div class="button-group">
                                <button id="enableSimulink" class="btn btn-primary">Enable Simulink</button>
                                <button id="disableSimulink" class="btn btn-outline">Disable Simulink</button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Simulation Status:</label>
                            <div id="simulinkStatusPanel" class="status-panel">
                                <div class="status-item">
                                    <span>MATLAB Connection:</span>
                                    <span id="matlabStatus">Disconnected</span>
                                </div>
                                <div class="status-item">
                                    <span>Data Flow:</span>
                                    <span id="dataFlowStatus">Inactive</span>
                                </div>
                                <div class="status-item">
                                    <span>Last Update:</span>
                                    <span id="lastSimulinkUpdate">Never</span>
                                </div>
                            </div>
                        </div>

                        <button id="sendToSimulink" class="btn btn-success">Send to Simulink</button>
                        <button id="requestFromSimulink" class="btn btn-info">Request from Simulink</button>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Simulink Data</h3>
                    <div class="data-display">
                        <pre id="simulinkData">No data received</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="grid-container">
                <div class="card">
                    <h3>üìä Performance Analytics</h3>
                    <canvas id="performanceChart"></canvas>
                </div>

                <div class="card">
                    <h3>üìà Historical Trends</h3>
                    <canvas id="historicalChart"></canvas>
                </div>

                <div class="card">
                    <h3>üîç System Diagnostics</h3>
                    <div class="diagnostics-grid">
                        <div class="diagnostic-item">
                            <label>System Uptime:</label>
                            <span id="systemUptime">00:00:00</span>
                        </div>
                        <div class="diagnostic-item">
                            <label>Total Production:</label>
                            <span id="totalProduction">0 kg</span>
                        </div>
                        <div class="diagnostic-item">
                            <label>Average Efficiency:</label>
                            <span id="avgEfficiency">75%</span>
                        </div>
                        <div class="diagnostic-item">
                            <label>Safety Events:</label>
                            <span id="totalSafetyEvents">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="mqtt.js"></script>
    <script src="charts.js"></script>
    <script src="navigation.js"></script>
    <script src="neural-mpc.js"></script>
    <script src="simulink-bridge.js"></script>
    <script src="app.js"></script>
</body>
</html>