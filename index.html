<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HE-NMPC Electrolyzer Controller</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="components.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <!-- SVG Icons -->
    <svg style="display: none;">
        <symbol id="icon-dashboard" viewBox="0 0 24 24">
            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
        </symbol>
        <symbol id="icon-control" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
        </symbol>
        <symbol id="icon-safety" viewBox="0 0 24 24">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
        </symbol>
        <symbol id="icon-economic" viewBox="0 0 24 24">
            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
        </symbol>
        <symbol id="icon-analytics" viewBox="0 0 24 24">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
        </symbol>
        <symbol id="icon-simulink" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-8 8z"/>
        </symbol>
        <symbol id="icon-status" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
        </symbol>
    </svg>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="24" height="24" fill="currentColor">
                            <use href="#icon-status"/>
                        </svg>
                    </div>
                    <h1>HE-NMPC Electrolyzer Controller</h1>
                </div>
                <div class="status-bar">
                    <div class="status-item">
                        <span class="status-dot" id="connectionStatus"></span>
                        <span id="connectionText">Connecting...</span>
                    </div>
                    <div class="status-item">
                        <span id="systemStatus">System Ready</span>
                    </div>
                    <div class="status-item">
                        <span id="currentTime">--:--:--</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <div class="nav-container">
                <button class="nav-btn active" data-tab="dashboard">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-dashboard"/>
                    </svg>
                    <span class="nav-text">Dashboard</span>
                </button>
                <button class="nav-btn" data-tab="control">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-control"/>
                    </svg>
                    <span class="nav-text">Control</span>
                </button>
                <button class="nav-btn" data-tab="safety">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-safety"/>
                    </svg>
                    <span class="nav-text">Safety MPC</span>
                </button>
                <button class="nav-btn" data-tab="economic">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-economic"/>
                    </svg>
                    <span class="nav-text">Economic MPC</span>
                </button>
                <button class="nav-btn" data-tab="analytics">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-analytics"/>
                    </svg>
                    <span class="nav-text">Analytics</span>
                </button>
                <button class="nav-btn" data-tab="simulink">
                    <svg class="nav-icon" width="20" height="20" fill="currentColor">
                        <use href="#icon-simulink"/>
                    </svg>
                    <span class="nav-text">Simulink</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="grid-layout">
                    <!-- Key Metrics -->
                    <div class="metric-card primary">
                        <div class="metric-header">
                            <h3>Oxygen Production</h3>
                            <span class="metric-trend positive">+2.3%</span>
                        </div>
                        <div class="metric-value" id="productionValue">0%</div>
                        <div class="metric-chart">
                            <canvas id="productionMiniChart"></canvas>
                        </div>
                    </div>

                    <div class="metric-card success">
                        <div class="metric-header">
                            <h3>System Efficiency</h3>
                            <span class="metric-trend positive">+1.2%</span>
                        </div>
                        <div class="metric-value" id="efficiencyValue">75%</div>
                        <div class="metric-chart">
                            <canvas id="efficiencyMiniChart"></canvas>
                        </div>
                    </div>

                    <div class="metric-card warning">
                        <div class="metric-header">
                            <h3>Safety Margin</h3>
                            <span class="metric-trend negative">-0.5%</span>
                        </div>
                        <div class="metric-value" id="safetyValue">100%</div>
                        <div class="metric-chart">
                            <canvas id="safetyMiniChart"></canvas>
                        </div>
                    </div>

                    <div class="metric-card info">
                        <div class="metric-header">
                            <h3>Stack Temperature</h3>
                            <span class="metric-trend stable">±0.0%</span>
                        </div>
                        <div class="metric-value" id="temperatureValue">25°C</div>
                        <div class="metric-chart">
                            <canvas id="temperatureMiniChart"></canvas>
                        </div>
                    </div>

                    <!-- Main Charts -->
                    <div class="card large">
                        <div class="card-header">
                            <h3>Production Trends</h3>
                            <div class="card-actions">
                                <button class="btn-icon" title="Export Data">
                                    <svg width="16" height="16" fill="currentColor">
                                        <use href="#icon-analytics"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <canvas id="productionChart"></canvas>
                        </div>
                    </div>

                    <div class="card large">
                        <div class="card-header">
                            <h3>System Parameters</h3>
                            <div class="card-actions">
                                <button class="btn-icon" title="Refresh Data">
                                    <svg width="16" height="16" fill="currentColor">
                                        <use href="#icon-control"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <canvas id="parametersChart"></canvas>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3>System Status</h3>
                        </div>
                        <div class="card-content">
                            <div class="status-grid">
                                <div class="status-item">
                                    <label>Controller Mode</label>
                                    <span class="status-badge success" id="controllerMode">HE-NMPC</span>
                                </div>
                                <div class="status-item">
                                    <label>Operation Mode</label>
                                    <span class="status-badge info" id="operationMode">AUTO</span>
                                </div>
                                <div class="status-item">
                                    <label>Safety Violations</label>
                                    <span class="status-badge danger" id="safetyViolations">0</span>
                                </div>
                                <div class="status-item">
                                    <label>Simulink Connection</label>
                                    <span class="status-badge warning" id="simulinkStatus">Disconnected</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Data Display -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Live Data Feed</h3>
                        </div>
                        <div class="card-content">
                            <div class="data-feed">
                                <div class="data-item">
                                    <span class="data-label">O2 Production Rate:</span>
                                    <span class="data-value" id="liveO2Production">--</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Stack Efficiency:</span>
                                    <span class="data-value" id="liveEfficiency">--</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Temperature:</span>
                                    <span class="data-value" id="liveTemperature">--</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Power Consumption:</span>
                                    <span class="data-value" id="livePower">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Tab -->
            <div id="control" class="tab-content" style="display: none;">
                <div class="tab-header">
                    <h2>Control Panel</h2>
                    <p>Manual control interface for system operation</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <div class="card-header">
                            <h3>System Controls</h3>
                        </div>
                        <div class="card-content">
                            <div class="control-group">
                                <button class="btn-primary control-btn" data-action="start">Start System</button>
                                <button class="btn-warning control-btn" data-action="stop">Stop System</button>
                                <button class="btn-danger control-btn" data-action="emergency">Emergency Stop</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Manual Setpoints</h3>
                        </div>
                        <div class="card-content">
                            <div class="control-item">
                                <label for="voltageSetpoint">Voltage Setpoint (V)</label>
                                <input type="number" id="voltageSetpoint" min="0" max="5" step="0.1" value="2.1">
                            </div>
                            <div class="control-item">
                                <label for="currentSetpoint">Current Setpoint (A)</label>
                                <input type="number" id="currentSetpoint" min="0" max="200" step="1" value="150">
                            </div>
                            <div class="control-item">
                                <label for="tempSetpoint">Temperature Setpoint (°C)</label>
                                <input type="number" id="tempSetpoint" min="20" max="80" step="1" value="65">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Safety MPC Tab -->
            <div id="safety" class="tab-content" style="display: none;">
                <div class="tab-header">
                    <h2>Safety MPC</h2>
                    <p>Safety constraint monitoring and enforcement</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <div class="card-header">
                            <h3>Safety Constraints</h3>
                        </div>
                        <div class="card-content">
                            <div class="constraints-grid">
                                <div class="constraint-item safe">
                                    <span class="constraint-label">Max Temperature</span>
                                    <span class="constraint-value">80°C</span>
                                    <span class="constraint-status">Safe</span>
                                </div>
                                <div class="constraint-item safe">
                                    <span class="constraint-label">Max Pressure</span>
                                    <span class="constraint-value">50 bar</span>
                                    <span class="constraint-status">Safe</span>
                                </div>
                                <div class="constraint-item safe">
                                    <span class="constraint-label">Max Current</span>
                                    <span class="constraint-value">200 A</span>
                                    <span class="constraint-status">Safe</span>
                                </div>
                                <div class="constraint-item safe">
                                    <span class="constraint-label">Min Efficiency</span>
                                    <span class="constraint-value">60%</span>
                                    <span class="constraint-status">Safe</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card large">
                        <div class="card-header">
                            <h3>Safety Margin Trends</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="safetyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Economic MPC Tab -->
            <div id="economic" class="tab-content" style="display: none;">
                <div class="tab-header">
                    <h2>Economic MPC</h2>
                    <p>Economic optimization and cost analysis</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <div class="card-header">
                            <h3>Cost Analysis</h3>
                        </div>
                        <div class="card-content">
                            <div class="economic-metrics">
                                <div class="metric-row">
                                    <span class="metric-label">Energy Cost:</span>
                                    <span class="metric-value">$0.12/kWh</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">H₂ Production Cost:</span>
                                    <span class="metric-value">$4.50/kg</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Operating Cost:</span>
                                    <span class="metric-value">$125.60/hr</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Revenue:</span>
                                    <span class="metric-value">$189.40/hr</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card large">
                        <div class="card-header">
                            <h3>Economic Optimization</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="economicChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content" style="display: none;">
                <div class="tab-header">
                    <h2>MPC Performance Analytics</h2>
                    <p>Real-time comparison of HE-NMPC vs Traditional MPC performance</p>
                </div>
                <div class="grid-layout">
                    <!-- MPC Performance Comparison -->
                    <div class="card large">
                        <div class="card-header">
                            <h3>MPC Performance Radar Comparison</h3>
                            <div class="card-actions">
                                <button class="btn-icon" id="refreshAnalytics" title="Refresh Analytics">
                                    <svg width="16" height="16" fill="currentColor">
                                        <use href="#icon-analytics"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <canvas id="performanceChart" height="300"></canvas>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Performance Metrics</h3>
                        </div>
                        <div class="card-content">
                            <div class="metrics-comparison">
                                <div class="metric-comparison-item">
                                    <span class="metric-label">Settling Time</span>
                                    <div class="metric-bars">
                                        <div class="metric-bar he-nmpc" style="width: 70%">
                                            <span class="metric-value">2.3s</span>
                                        </div>
                                        <div class="metric-bar traditional" style="width: 100%">
                                            <span class="metric-value">3.8s</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-comparison-item">
                                    <span class="metric-label">Overshoot</span>
                                    <div class="metric-bars">
                                        <div class="metric-bar he-nmpc" style="width: 40%">
                                            <span class="metric-value">4.2%</span>
                                        </div>
                                        <div class="metric-bar traditional" style="width: 100%">
                                            <span class="metric-value">12.7%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-comparison-item">
                                    <span class="metric-label">Energy Efficiency</span>
                                    <div class="metric-bars">
                                        <div class="metric-bar he-nmpc" style="width: 95%">
                                            <span class="metric-value">78.3%</span>
                                        </div>
                                        <div class="metric-bar traditional" style="width: 82%">
                                            <span class="metric-value">65.1%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-comparison-item">
                                    <span class="metric-label">Constraint Violations</span>
                                    <div class="metric-bars">
                                        <div class="metric-bar he-nmpc" style="width: 10%">
                                            <span class="metric-value">0.2%</span>
                                        </div>
                                        <div class="metric-bar traditional" style="width: 100%">
                                            <span class="metric-value">3.1%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Performance Trends -->
                    <div class="card large">
                        <div class="card-header">
                            <h3>Real-time Performance Trends</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="trendsChart" height="250"></canvas>
                        </div>
                    </div>

                    <!-- MPC Configuration Comparison -->
                    <div class="card">
                        <div class="card-header">
                            <h3>MPC Configuration</h3>
                        </div>
                        <div class="card-content">
                            <div class="config-comparison">
                                <div class="config-item">
                                    <h4>HE-NMPC (Hybrid Evolutionary)</h4>
                                    <ul>
                                        <li>• Prediction Horizon: 25 steps</li>
                                        <li>• Control Horizon: 10 steps</li>
                                        <li>• Population Size: 50</li>
                                        <li>• Mutation Rate: 0.15</li>
                                        <li>• Neural Network: 3-layer LSTM</li>
                                    </ul>
                                </div>
                                <div class="config-item">
                                    <h4>Traditional MPC</h4>
                                    <ul>
                                        <li>• Prediction Horizon: 15 steps</li>
                                        <li>• Control Horizon: 5 steps</li>
                                        <li>• QP Solver: Active Set</li>
                                        <li>• Sampling Time: 1.0s</li>
                                        <li>• Linear Model Only</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulink Tab -->
            <div id="simulink" class="tab-content" style="display: none;">
                <div class="tab-header">
                    <h2>Simulink Integration</h2>
                    <p>MATLAB/Simulink model integration and real-time data streaming</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <div class="card-header">
                            <h3>Simulink Connection</h3>
                        </div>
                        <div class="card-content">
                            <div class="connection-status">
                                <div class="status-item">
                                    <span class="status-label">MATLAB Connection:</span>
                                    <span class="status-value connected" id="matlabStatus">Connected</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Simulink Model:</span>
                                    <span class="status-value">PEM_Electrolyzer_v2.slx</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Last Update:</span>
                                    <span class="status-value" id="simulinkLastUpdate">--:--:--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Data Points Received:</span>
                                    <span class="status-value" id="dataPointsCount">0</span>
                                </div>
                            </div>
                            <div class="simulink-controls">
                                <button class="btn-primary" id="startSimulation">Start Simulation</button>
                                <button class="btn-warning" id="stopSimulation">Stop Simulation</button>
                                <button class="btn-secondary" id="updateModel">Update Parameters</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card large">
                        <div class="card-header">
                            <h3>Simulink Data Stream</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="simulinkChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Simulation Parameters</h3>
                        </div>
                        <div class="card-content">
                            <div class="simulation-params">
                                <div class="param-item">
                                    <label>Simulation Time</label>
                                    <span id="simTime">0 s</span>
                                </div>
                                <div class="param-item">
                                    <label>Step Size</label>
                                    <span>0.1 s</span>
                                </div>
                                <div class="param-item">
                                    <label>Solver</label>
                                    <span>ode4 (Runge-Kutta)</span>
                                </div>
                                <div class="param-item">
                                    <label>Data Rate</label>
                                    <span id="dataRate">0 Hz</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Real-time Data</h3>
                        </div>
                        <div class="card-content">
                            <div class="real-time-data">
                                <div class="data-item">
                                    <span>O₂ Production:</span>
                                    <span id="simO2Production">-- L/min</span>
                                </div>
                                <div class="data-item">
                                    <span>Stack Temp:</span>
                                    <span id="simStackTemp">-- °C</span>
                                </div>
                                <div class="data-item">
                                    <span>Efficiency:</span>
                                    <span id="simEfficiency">-- %</span>
                                </div>
                                <div class="data-item">
                                    <span>Power:</span>
                                    <span id="simPower">-- kW</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- JavaScript Files -->
    <script src="mqtt.js"></script>
    <script src="charts.js"></script>
    <script src="navigation.js"></script>
    <script src="neural-mpc.js"></script>
    <script src="simulink-bridge.js"></script>
    <script src="app.js"></script>
</body>
</html>
